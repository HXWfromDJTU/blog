# Socket
![](/blog_assets/socket_cover.png)

## 简要理解
1️⃣ 网络上的两个程序通过一个双向链接实现数据的交换，这个连接的一段被称之为`socket`。   

2️⃣ `socket`的本质是一个编程接口，对TCP/IP进行了封装，`TCP/IP`也要提供可供开发者做网络开发的接口。  

3️⃣ `HTTP`是轿车🚘，提供了封装或者显示数据的具体形式，`socket`是发动机，提供了网络通信的能力。    

4️⃣ 一台主机上多个端口，对应着不同的应用服务，每个服务都打开一个`socket`,并且绑定到一个端口上。   

5️⃣ 一台主机就像一个布满插座的房间，有的插座提供的是直流电，有的插座提供的是交流电，有的插座提供的是一个电视信号，用户通过插头插到不同的插座，就可以得到不同的服务。    

![](/blog_assets/socket.png)    




## 连接过程
根据连接启动的方式以及本地套接字要连接的目标，套接字之间的连接过程可以分为三个步骤：服务器监听，客户端请求，连接确认。

1️⃣ 服务器监听：是服务器端套接字并不定位具体的客户端套接字，而是处于等待连接的状态，实时监控网络状态。

2️⃣ 客户端请求：是指由客户端的套接字提出连接请求，要连接的目标是服务器端的套接字。为此，客户端的套接字必须首先描述它要连接的服务器的套接字，指出服务器端套接字的地址和端口号，然后就向服务器端套接字提出连接请求。

3️⃣ 连接确认：是指当服务器端套接字监听到或者说接收到客户端套接字的连接请求，它就响应客户端套接字的请求，建立一个新的线程，把服务器端套接字的描述发给客户端，一旦客户端确认了此描述，连接就建立好了。而服务器端套接字继续处于监听状态，继续接收其他客户端套接字的连接请求。

* socket 是一套用于Unix进程间通信的api。IP + 端口 等于网络socket的地址
* UNIX中一切皆是文件的哲学，常规意义的文件、目录、管道、socket都可以看成文件。
* fd是内核提供给用户安全操作文件的标识，标识符而不像指针，你不能进行修改，只能以当做参数传递给系统不同的api，告知系统该处理哪些文件。

在双方通信之前，双方都需要建立一个socket,端到端的通信
包括网络层和传输层的一些参数 
TCP是基于数据流的，而UDP是基于数据包的。
指定 TCP还是UDP  SOCK_STREAM   SOCK_DGRAM
IPV-4 IPV-6  AF_INET 和 AF_INET6
bind函数
TCP有个listen状态
listen函数
维护两个队列:已经完成的队列
estabilsh状态
syn_rcvd状态

read 与 write

TCPde socke

写入和写出，就是读取这个文件描述符
文件描述符

发送队列 与 接收队列

socket在内核中就是一个文件
他就应该有文件描述符
每一个TCP链接都要占用一定的内存  

Linux 创建一个子进程 fork,进程复制的时候回把文件描述符列表全部拷贝一遍,也会复制内存空间，也会记录代码执行的位置
创建多线层，就可以共用文件描述符
IPC 进行通信？

线程会轻量级的多，办公家具可以共用。

C10K 一台机器要创建10K个链接，一亿个用户要10W台服务器
I/O多路复用，项目进度墙

I/O多路复用

epoll注册callback，某个文件描述符发生了变化
epoll函数

红黑树、平衡二叉树  随着输的节点更多，但是树的结构不会变得特别深   epoll entry 


服务端最大的连接数是 2的48次方   

fd_size  

win:IOCP

linux:epoll  通过callback的机制通知，可以突破最大文件描述符的限制  解决C10K问题的利器  




UDP 
sendTo receiveFrom 

客户端的IP数目 X 客户端的端口数目


创建子进程 fork 完完全全复制一个主进程，文件描述符的列表，内存空间，一条记录（指明当前执行到那一行）
