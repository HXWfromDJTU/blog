# ES6 module

## æº¯æº
* ä¸å‰è¾ˆ`CommonJS`ã€`AMD` ä¸åŒï¼Œ è€Œ`ES6` å°è¯•åœ¨è¯­è¨€å±‚é¢ä¸Šå®ç°äº†æ¨¡å—åŒ–çš„åŠŸèƒ½
* `CommonJS` ä¸ `AMD` éƒ½éœ€è¦ç¨‹åºè¿è¡Œæ—¶æ‰èƒ½å¤ŸçŸ¥é“æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚è€Œ`ES 6 Module`è¦åšåˆ°çš„æ˜¯å°½é‡çš„é™æ€åŒ–ï¼Œåœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠè¾“å‡ºå’Œè¾“å‡ºçš„å†…å®¹ã€‚



## export

##### å»ºç«‹å¯¹åº”å…³ç³»
> `export` å‘½ä»¤è§„å®šçš„æ˜¯å¯¹å¤–çš„æ¥å£ï¼Œèµ·çš„ä½œç”¨å¿…é¡»æ˜¯ä¸æ¨¡å—å†…éƒ¨å»ºç«‹èµ·`ä¸€ä»¥å¯¹åº”`çš„å…³ç³»ã€‚

##### åŠ¨æ€ç»‘å®š
> `export`è¯­å¥è¾“å‡ºçš„æ¥å£ï¼Œä¸å…¶å¯¹åº”çš„æ˜¯åŠ¨æ€ç»‘å®šçš„å…³ç³»ï¼Œæ¨¡å—å†…éƒ¨å€¼çš„å˜åŒ–ï¼Œä¼šå¼•èµ·å¤–éƒ¨å¼•ç”¨çš„å˜åŒ–ã€‚

ä¾‹å­ä¸€:
```js
// modulesA.js
export const number = 3
export function add () {
  number ++
}

// app.js
import { number, add } from 'moduleA'
console.log(number) // 3
add()
console.log(number) // 4
```

ä¾‹å­äºŒ: 
```js
// moduleA.js
class ModuleA {
  this.name = 'moduleA'
  this.getName = function () {
    return this.name
  }
}

export const objA = new ModuleA()

// a.js
import { objA } from 'moduleA'
objA.name = 'name has been changed'

// b.js
import { objA } from 'moduleA'
setTimeout(() => {
  console.log(objA.name) // 'name has been changed'
})
```
ä»¥ä¸Šä¸¤ä¸ªä¾‹å­éƒ½å¯ä»¥è¯´æ˜ï¼Œæ¨¡å—å†…éƒ¨ï¼Œå¼•ç”¨æ–¹æ‹¿åˆ°çš„æ¨¡å—å¼•ç”¨ï¼Œéƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä»»æ„ä¸€æ–¹æ”¹å˜äº†å†…å­˜ç©ºé—´å­˜å‚¨çš„å€¼ï¼Œé‚£ä¹ˆä»»æ„ä¸€æ–¹å–åˆ°çš„éƒ½æ˜¯æœ€æ–°çš„å€¼ã€‚

##### å¿…é¡»å¤„äºé¡¶çº§æ¨¡å—
> `ES6 Module` çš„åˆè¡·æ˜¯å®ç°é™æ€åˆ†ææ¨¡å—åŒ–ï¼Œæ‰€ä»¥exportå¿…é¡»å¤„äºæ¨¡å—é¡¶å±‚ä¸­ï¼Œä¸èƒ½å¤„äºå—çº§ä½œç”¨åŸŸå†…ã€‚


## import

##### å˜é‡æå‡
> `import`ä¼šåœ¨é™æ€è§£ææ—¶ï¼Œä¼šå› ä¸ºå˜é‡æå‡è§£æ‹†åˆ†æˆå£°æ˜ä¸èµ‹å€¼ä¸¤ä¸ªéƒ¨åˆ†ã€‚
```jsÂ·
console.log(abc)
import { abc } from 'module.js' // å¹¶ä¸ä¼šæŠ¥é”™
```

##### é™æ€æ¨¡å—
> ä¸`export`ç›¸ç±»ä¼¼ï¼ŒåŒæ ·éµå¾ª`ES 6`é™æ€æ¨¡å—åˆ†æçš„è®¾è®¡åˆè¡·ï¼Œ`import` è¯­å¥åŒæ ·ä¸èƒ½å¤„äº`å—çº§ä½œç”¨åŸŸ`ä¸­ï¼Œå¯¼å‡ºçš„å€¼ä¹Ÿä¸èƒ½å¤Ÿæ˜¯`éœ€è¦è¿ç®—åå¾—å‡ºçš„ç»“æœ`ã€‚

##### å¼•ç”¨ä¸å¯ä¿®æ”¹
> `import`å‘½ä»¤è¾“å…¥çš„å˜é‡éƒ½æ˜¯åªè¯»çš„ï¼Œå› ä¸ºæœ¬è´¨ä¸Šæ¥è¯´ï¼Œå¼•å…¥çš„æ˜¯`è¾“å…¥æ¥å£`ã€‚æ”¹å˜å¼•ç”¨æœ¬èº«ï¼Œåˆ™ä¼šç ´åæ¨¡å—ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€‚

åŸåˆ™ä¸Šä¸å…è®¸ä¿®æ”¹æ¥å£ï¼Œä½†å¯ä»¥ä¿®æ”¹æ¥å£é‡Œé¢çš„å€¼ï¼Œå…¶ä»–çš„æ¨¡å—ä¹Ÿèƒ½å¤Ÿæ‹¿åˆ°ä¿®æ”¹åçš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºè¿™æ ·çš„ä¿®æ”¹æ˜¯ä¸å¯ä»¥è¿½è¸ªçš„ã€‚     

å¦‚ä¸‹ä¾‹å­: 
```js
// common.js
export const config = {
  port: '8899',
  host: '123.77.33.56'
}

// a.js
import { config } from 'common.js'
config.port = '1234' // ä¸ä¼šæŠ¥é”™

//b.js
import { config } from 'common.js'
console.log(config.port) // ä¸€è„¸æ‡µé€¼åœ°æ‹¿åˆ°äº† 1234è¿™ä¸ªå€¼ï¼Œbçš„å¼€å‘è€…å›å»çœ‹ common.js åˆå‘ç°ä¸äº†é—®é¢˜
```


##### ä»…æ‰§è¡Œä½†ä¸å¼•å…¥
> ä¸€ä¸‹çš„è¯­å¥ï¼Œä»…ä»…ä¼šæ‰§è¡Œ`my.module`æ¨¡å—çš„å†…å®¹ï¼Œä½†å¹¶ä¸ä¼šå¼•å…¥ä»»ä½•ä»£ç ã€‚
```js
import 'my-module'
```

##### æ•´ä½“å¼•å…¥
```js
import * as myModule from 'my-module'
```

##### è·¯å¾„è§£æ
> ä¼˜å…ˆè§£æ`./`ä¸`../`ç­‰ç›¸å¯¹è·¯å¾„ï¼Œç›´æ¥å†™`æ¨¡å—åç§°`åˆ™éœ€è¦æ ¹æ®é…ç½®æ–‡ä»¶çš„è§„åˆ™æ¥çº¦å®šã€‚

```bat
$ node --experimental-modules a.mjs  # è¿™é‡Œç”¨nodeæ¥è¿è¡Œä¸€ä¸‹
```
æ¯”å¦‚å‡ºç°ä»¥ä¸Š`å¾ªç¯å¼•ç”¨`çš„æƒ…å†µä¸‹ï¼Œ`a.js`ä¸ºå…¥å£`moduleB`è¢«é¦–å…ˆåŠ è½½

## import()
##### è¡¥å……äº†è¿è¡Œæ—¶è§£æ
* `ES 6 Module`çš„æœ€ç»ˆç›®çš„æ˜¯è¦å–ä»£`CommonJS` ä¸ `AMD`ï¼Œä¸€ç»Ÿå¤©ä¸‹ã€‚é‚£ä¹ˆåœ¨`è¿è¡Œæ—¶`çš„æ¨¡å—åŒ–ä¸­ï¼Œä½¿ç”¨`import()`å‡½æ•°æ¥æ›¿ä»£`require()`æ–¹æ³•ã€‚
* `import()` ä¸ `import` è¯­å¥ä¸ä¸€æ ·ï¼Œå‰è€…äº§ç”Ÿçš„æ˜¯`è¿è¡Œæ—¶æ‰§è¡Œçš„å¼‚æ­¥åŠ è½½`ï¼Œåè€…äº§ç”Ÿçš„æ˜¯`é™æ€çš„è¿æ¥å…³ç³»`ã€‚

##### å¼‚æ­¥åŠ è½½
> `import()` è¿›è¡Œå¼‚æ­¥åŠ è½½ï¼Œæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª`Promise`å¯¹è±¡ï¼Œé‚£ä¹ˆæ˜¾è€Œæ˜“è§çš„`require()`åˆ™æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶åŒæ­¥åŠ è½½çš„è¿‡ç¨‹ã€‚

```js
// å¼‚æ­¥åŠ è½½
import list from './list';

// åŒæ­¥åŠ è½½
const list = require('./list');
```

##### ä½¿ç”¨åœºæ™¯
> å› ä¸º`import()`æ˜¯è¿è¡Œæ—¶æ‰§è¡Œï¼Œæ˜¾è€Œæ˜“è§çš„æˆ‘ä»¬å¯ä»¥ç”¨äºåš`code spliting`ã€‚

```js
const router = new VueRouter({
  routes: [
    { 
      path: '/foo', component: import('./Foo.vue'),
      path: '/bar', component: import('./Bar.vue'),
    }
  ]
})
```
è¯¦ç»†è¯·å‚è€ƒ[ğŸ‘‰è¿™é‡Œ](https://router.vuejs.org/zh/guide/advanced/lazy-loading.html#%E6%8A%8A%E7%BB%84%E4%BB%B6%E6%8C%89%E7%BB%84%E5%88%86%E5%9D%97)


## export default

##### é»˜è®¤åç§°ä¸º default
> ä½¿ç”¨ `export default`ç›¸å½“äºå¯¹å¤–æš´éœ²äº†ä¸€ä¸ª`åä¸º default`çš„å˜é‡ï¼Œå˜é‡çš„å€¼ç›´æ¥è·Ÿåœ¨`export default`åé¢ã€‚



## export from

##### æ¨¡å—è½¬å‘
> ä½¿ç”¨`export from`å¯ä»¥å®ç°æ¨¡å—è½¬å‘ï¼Œ(è¡¨é¢ä¸Šç›¸å½“äºæ˜¯import ä¸ exportçš„ç»“åˆ)ï¼Œä½†è¦å®é™…è¿›è¡Œé™æ€è§£æçš„æ—¶å€™ï¼Œå½“å‰æ¨¡å—æ˜¯æ²¡æœ‰å¼•å…¥ç›®æ ‡å¯¹è±¡çš„ã€‚

```js
// moduleA
export { foo, bar } from 'moduleB'

console.log(foo) // error
```

##### è½¬å‘æ¥å£æ”¹å
> ä¸­é—´æ¨¡å—è½¬å‘æ¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹æ¥å£è¿›è¡Œæ”¹å
```js
export { default as myModule } from 'that-module'

export * as myModule from 'that-module'
```

## æ ‡ç­¾å¼•å…¥ 

##### type="module"
```html
<script type="module" src="./foo.js" type="module"></script>

<!-- æ•ˆæœç±»ä¼¼äº -->
<script src="./foo.js" defer></script>
```

>`defer`å…³é”®å­—è¡¨ç¤ºè„šæœ¬çš„`æ‰§è¡Œ`å»¶è¿Ÿåˆ°æ–‡æ¡£åŠ è½½å®Œæˆä¹‹åã€‚

![](/blog_assets/defer_script.png)    

> `module`å…³é”®å­—ä¹Ÿèƒ½å¤Ÿä½¿å¾—JSåœ¨DOMåŠ è½½å®Œåæ‰æ‰§è¡Œï¼Œå…¼å®¹æ€§ä¸å¦‚å‰è€…,IEå°æ€ï¼Œedge 16+,FF60+,Chrome 61+

![](/blog_assets/module_script.png)   

å½“äºŒè€…åŒæ—¶å‡ºç°çš„æ—¶å€™ï¼Œæ‰§è¡Œé¡ºåºæ˜¯`ä¸€èˆ¬è„šæœ¬` >  `moduleè„šæœ¬`  > `deferè„šæœ¬` > `DOMContentLoadedäº‹ä»¶`           


## å‚è€ƒèµ„æ–™
[ES 6 å…¥é—¨ é˜®ä¸€å³°- Module çš„è¯­æ³•](https://es6.ruanyifeng.com/#docs/module)