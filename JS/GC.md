# Javascript 的GC机制
Javascript是一门具有垃圾回收机制的编程语言，程序员大部分情况下不用手动去操心内存管理的问题。

但是，`Javascript IN Browser`却是一个特殊的情况，分配给Web浏览器的空间一般会比分配给常用桌面程序的少，当然这是为了避免用户浏览网页也能够造成内存的溢出，甚至系统奔溃的情况。

但是限制内存大下上限，相当于给一个武林高手绑上了手脚，会影响给变量声明时的内存分配，同事还会影响调用栈以及在一个线程中能够同时执行的`语句数量`。

### 手动清除
一旦数据不再使用，最好通过将其值设置为`null`来释放其引用，这个做法叫做`解除引用（dereferencing）`

一般会针对全局对象的属性进行解除引用操作，局部变量会在离开执行环境的时候自动被解除引用。

解除引用后并不会马上释放内存，只是相当于打上了一个标记，本轮GC回收的时候，会直接将指向`null`的数据原所占内存释放掉。

___
### 自动回收
##### 标记清除法
标记清除是目前主流的垃圾收集算法，这种算法的思想是给当前不使用的值加上标记，然后再回收其内存。
当变量进入环境，就将这个变量标记为`“进入环境”`，逻辑上进入环境的变量使用的可能性就很高，则肯定不能够将其所占用的内存释放掉。当变量离开环境的时候，则标记为“离开环境”，在下一轮清理时，释放其所占内存。
###### 过程
① GC回收器给在内存中的所有变量都加上标记

② 利用当前作用域链关系，给当前可能需要使用的变量去除标记

③ 在此后再被加上标记的变量被视为被删除掉的变量

④  垃圾回收器质性内存清除工作，销毁那些带标记的回收值，并回收他们的空间。
#####  引用计数法
引用计数的主要思想是跟踪每一个值被引用的次数

当声明了一个变量，并将一个引用类型赋值给该变量时，则改变量的引用次数加`1`。
当包含这个值引用的变量，被替换为另一个值，那么该值的引用次数减`1`。

最后`GC`将引用次数为0的变量所占的内存空间清除。

###### 问题
① 引用计数法遇到循环引用的时候，就算后续不再使用，但是引用计数很难变为`0`，导致大量的内存得不到回收，为此，`Netscape`在4.0后放弃了引用计数法。
```js
function Person(){
    let objA= new Object();
    let objB = new Object();
    // 相互引用，形成循环
    objA.toB = objB;   
    objB.toA = objA;
}
```
② 引用计数法在`IE`中访问非原生`Javascript`对象(如`DOM`元素)时，这种算法仍然会导致问题。`IE 8`(包括)之前，针对`DOM`对象使用的还是引用计数法，当出现循环引用的时候，也会出现内存清除不正常的问题。

___
### 参考资料
《Javascript 高级程序设计 第三版》