# how_browser_work 
>了解目的：为了项目的更好优化，为了提高浏览器的解析速率，减少页面无用的重绘，重置

### 一个请求的生命周期：

1️⃣ 用户输入网址(URL),浏览器查找DNS服务器，寻找对应的ip地址  

2️⃣ 浏览器根据ip地址，向服务器发送获取资源的请求  

3️⃣ 服务器端返回一个HTML响应

4️⃣ 浏览器收到返回的内容，浏览器开始解析HTML内容  

### 浏览器的解析

* 浏览器开始载入html代码，发现＜head＞标签内有一个＜link＞标签引用外部CSS文件；
*  浏览器又发出另一个CSS文件的请求，服务器返回这个CSS文件，`解析`过程不阻塞；
* 浏览器继续载入html中＜body＞部分的代码，并且CSS文件已经拿到手之后，开始`渲染`页面了；
*  浏览器在代码中发现一个`＜img＞`标签引用了一张图片，向服务器发出请求。此时浏览器不会等到图片下载完，而是继续`渲染`后面的代码；
* 服务器返回图片文件，由于图片占用了一定`面积`(宽度高度)，影响了后面段落的`排布`，因此浏览器需要回过头来重新渲染这部分代码；
* 浏览器发现了一个包含一行`Javascript`代码的＜script＞标签，会立即执行；浏览器发现一个外链的`<script>`标签，会等待资源返回后继续进行HTML解析。若内JS容中有执行错误，则页面停止解析。
* 执行的`script`内容中，有队DOM进行的操作，其中的操作有可能引起浏览器的`重绘`或者`重新渲染`。
* 直行至`</html>`标签，解析完毕
* 用户若有异步的JS操作，也同样会引起浏览器的`重绘`或者`重新渲染`。(例如用户点击按钮，某个部分隐藏)

![rendingprocess](blog_assets/redning_process.png)
![rendingtree](blog_assets/rendingtree.png)

## 重点释义：
* Reflow 
  释义：浏览器发现某个部分的变化，影响了布局，就需要重新回去渲染。
* Repaint 
  释义：浏览器发现，某些变化只是改变了背景颜色，文字颜色，不影响元素周围或者内容的属性，浏览器将只会进行repaint。

  `Reflow` 相比 `Repaint`更加浪费时间，也就更加影响性能。需要尽量避免。

* 外链`css`的异步加载不会阻塞`HTML`的解析，但会阻塞页面的渲染

* 外链的`script`标签会阻塞`HTML`的加载，加载完后也会立即执行。内嵌的`script`标签的JS代码也会遇到就立即执行

* 无论外链，还是内嵌。JS代码中的运行若出错，HTML会停止解析。（包括页面的渲染、其它资源的下载）

## 引申出的优化编码规范
* 将所有`script`内容放置到`body`标签的末尾去，最大程度避免页面加载的阻塞，也避免操作到未加载的DOM内容
* 尽可能地减少script外链的数目，减少网络请求次数(对此，可以使用`gulp`和`webpack`等打包工具实现)
* 使用现代浏览器的异步非阻塞加载
  * defer属性
  * 使用JS代码动态插入`script`外链标签
