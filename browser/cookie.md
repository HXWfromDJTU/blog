# æµè§ˆå™¨ä¸­çš„cookie  
![](/blog_assets/cookie_cover.png)
### cookieæ˜¯ä»€ä¹ˆ  
é¦–å…ˆå®šä¹‰ä¸€ä¸‹ï¼Œcookieæ˜¯ä¸€æ®µè®°å½•ç”¨æˆ·ä¿¡æ¯çš„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„å†…å­˜æˆ–è€…ç¡¬ç›˜ä¸­ã€‚       
![](/blog_assets/cookie_file.png)     
##### ä½¿ç”¨æµè§ˆå™¨ç•Œé¢çœ‹çœ‹æŸ¥çœ‹
![](/blog_assets/ff_cookie.png)
### æœåŠ¡ç«¯è¯»å†™cookie    
cookieçš„åˆ›å»ºæ˜¯ç”±æœåŠ¡ç«¯çš„å“åº”å¤´ï¼Œå…¶ä¸­å¸¦ç€`set-cookie`çš„å­—æ®µï¼Œæ¥å¯¹å®¢æˆ·ç«¯è¿›è¡Œcookieè®¾ç½®ã€‚   

![](/blog_assets/cookie_set.png) 

#### å¸¸ç”¨å­—æ®µæœ‰  
`name` è¡¨ç¤ºcookieçš„åç§°    

`value` å­—æ®µè¡¨ç¤ºcookieçš„å€¼       

##### `domain` 
è¡¨ç¤ºcookieçš„æœ‰æ•ˆåŸŸï¼Œé»˜è®¤å€¼ä¸ºå½“å‰åŸŸåã€‚                   
ğŸ‘‰ ä¸€ä¸ªæœåŠ¡å™¨èƒ½å¤Ÿè®¾ç½®`domian`çš„æœ‰æ•ˆçš„èŒƒå›´æ˜¯ï¼Œä»è‡ªèº«åŸŸåå¼€å§‹ï¼Œ`å‘ä¸Š`è¿½æº¯åˆ°ä¸€çº§åŸŸåã€‚æ¯”å¦‚`a.b.c.baidu.com`èƒ½å¤Ÿè®¾ç½®æœ‰æ•ˆçš„cookie-domainæ˜¯`.a.b.c.baidu.com`ã€`.b.c.baidu.com`ã€`.c.baidu.com`ã€`.baidu.com`ã€‚åŒæ ·çš„ï¼Œåœ¨è¯»å–cookieå¹¶ä¸”é€šè¿‡http requestå‘é€cookieæ—¶ï¼Œä¹Ÿæ˜¯å»åŒ¹é…åŒ¹é…ä¸Šè¿°è§„åˆ™èŒƒå›´å†…çš„cookieä¸€å¹¶å‘é€åˆ°æœåŠ¡å™¨ã€‚      
ğŸ‘‰ ä¸èƒ½å¤Ÿè·¨`ä¸Šçº§åŸŸå`è®¾ç½®å…¶ä»–åŸŸçš„å­åŸŸã€‚ä¸èƒ½å¤Ÿè®¾ç½®`.a.u.c.baidu.com`ã€‚       
ğŸ‘‰ å½“æœåŠ¡å™¨æƒ³å…±äº«`cookie`å€¼ç»™æ‰€æœ‰äºŒçº§åŸŸåçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„`cookie`å°±åº”è¯¥è®¾ç½®ä¸º`å…±åŒçš„ä¸Šä¸€çº§åŸŸå`ã€‚æ¯”å¦‚`.baidu.com`(å¸¸ç”¨äºå•ç‚¹ç™»å½•)       

â­•ï¸ åœ¨ä¸domainä¸‹çš„cookieå³ä½¿åŒåä¹Ÿä¸ä¼šè¦†ç›–ï¼Œè‹¥åœ¨åŒä¸€ä¸ªdomainä¸‹ï¼ŒåŒåçš„cookieåè€…ä¼šè¦†ç›–å‰è€…ã€‚   

â­•ï¸ è‹¥ä¸æ˜¾ç¤ºè®¾ç½®`cookie`çš„`domain`å€¼ï¼Œåˆ™æµè§ˆå™¨ä¼šå¤„ç†ä¸ºç”Ÿæˆä¸€ä¸ªåªå¯¹å½“å‰åŸŸåæœ‰æ•ˆçš„`cookie`ã€‚æ¯”å¦‚åœ¨`map.baidu.com`ä¸‹ï¼Œæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªcookieï¼Œä½†æ²¡æœ‰æŒ‡å®šdomainå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªcookie,åªæœ‰åœ¨è®¿é—®`map.baidu.com`æ—¶å€™æœ‰æ•ˆï¼Œè€Œ`abc.map.baidu.com`å’Œ`user.map.baidu.com`éƒ½æ˜¯æ‹¿ä¸åˆ°çš„ã€‚        

â­•ï¸ å»ºè®®è®¾ç½®cookieæ—¶å€™ï¼Œéƒ½å¸¦ä¸Š`.`ç¬¦å·ï¼Œå¦‚`.a.b.c.baidu.com`ã€‚


##### `path`    
ä¹Ÿè¡¨ç¤ºé™åˆ¶cookieçš„æœ‰æ•ˆèŒƒå›´ï¼Œä¸`domain`å…±åŒä½œç”¨,é»˜è®¤å€¼ä¸º`/`è¡¨ç¤ºæ‰€æœ‰è·¯å¾„          
æ¯”å¦‚è¯´`domain`ä¸º`www.abc.com`,`path`ä¸º`/sale/img`ï¼Œåˆ™åªæœ‰åŒ¹é…`www.abc.com/sale/img`è·¯å¾„çš„èµ„æºæ‰å¯ä»¥è¯»å–`cookie`ã€‚  
è°¨è®°ï¼Œè¿™é‡Œçš„è§„åˆ™æ˜¯`åŒ¹é…æ¨¡å¼`çš„ï¼Œä¹Ÿå°±æ˜¯å‘ååŒ¹é…ï¼Œä¸Šé¢çš„ä¾‹å­ä¹Ÿèƒ½åŒ¹é…`www.abc.com/sale/img/qqq/ss`      

`expire/Max-Age`è¡¨ç¤ºä¸ºcookieçš„æœ‰æ•ˆæ—¶é—´       
é»˜è®¤å€¼session,ä¹Ÿå°±æ˜¯æŒ‡æµè§ˆå™¨sessionï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·å…³é—­æµè§ˆå™¨å°±ä¼šæ¸…é™¤æ‰è¿™ä¸ªcookieã€‚       
è‹¥æ˜ç¡®è®¾ç½®æ—¶é—´ï¼Œåˆ™è¡¨ç¤ºåœ¨æ­¤æ—¶é—´å‰ï¼Œcookieå§‹ç»ˆæœ‰æ•ˆã€‚    
expire çš„å€¼ä¸ºä¸€ä¸ªæ—¥æœŸæ—¶é—´     
Max-Age çš„å€¼ä¸ºä¸€ä¸ªç§’å€¼   

`size` è¡¨ç¤ºcookieçš„å¤§å°     

##### `secure` 
è‹¥è®¾ç½®ä¸ºtrueï¼Œåˆ™è¡¨è¡¨ç¤ºæ­¤`cookie`åªä¼šåœ¨httpsåè®®æˆ–è€…sslç­‰å®‰å…¨åè®®ä¸‹è¿›è¡Œå‘é€ã€‚ 
```js
document.cookie = "username=cfangxu; secure"
```

##### `http-only` 
è¡¨ç¤ºè¯¥cookieåªä¼šåœ¨httpè¯·æ±‚ä¼ è¾“çš„æ—¶å€™æºå¸¦ï¼Œè€Œä¸èƒ½å¤Ÿè¢«æœ¬åœ°çš„JavaScriptè„šæœ¬æ‰€è¯»å–åˆ°ã€‚(å¯ä»¥ç®€è¦çš„é˜²æ­¢XSSæ”»å‡»)ã€‚     

### å®¢æˆ·ç«¯è¯»å†™Cookie 
è¯»å–cookieå¯ä»¥ä½¿ç”¨`docuemnt.cookie`
![](/blog_assets/js_cookie.png)  
å†™å…¥cookieä¹Ÿæ˜¯ç”¨çš„æ˜¯è¿™ä¸ªå±æ€§ï¼Œä½†è¦æ³¨æ„ï¼Œä½†æ˜¯ä¸æ”¯æŒåŒæ—¶è®¾ç½®å¤šä¸ªcookieï¼Œéœ€è¦åˆ†å¼€å¤šæ¬¡è°ƒç”¨è®¾ç½®å±æ€§å€¼ã€‚       
```js
document.cookie = 'userId=xusfh123; maxAge=5000ï¼›path=/;secure'
``` 
##### æ ¼å¼åŒ–cookie
```js
// æ ¼å¼åŒ–cookieå‡½æ•°
function getCookieJson() { 
    var cookie = document.cookie;
    var pattern = /([^=]+)=([^;]+);?\s*/g;
    var result, value = {}; 
    while((result = pattern.exec(cookie)) != null) {
         value[result[1]] = result[2]; 
         } return value; 
   }
```
![](/blog_assets/parse_cookie.png)
##### åˆ é™¤cookie 
æ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œåˆ é™¤ä¸€ä¸ªcookieçš„æ–¹æ³•å°±æ˜¯æŠŠå¯¹åº”å­—æ®µçš„`cookie`å€¼ç½®ç©ºã€‚
```js 
function setCookie(name,value){
    var cookies = getCookieJson(); // è·å–Json æ ¼å¼çš„ cookie
    cookies[name] = value; // è®¾ç½®cookie
    var result =[];
    for(var key in cookies){
        if(cookies[key]!==''){ // è¿‡æ»¤æ‰è¢«ç½®ç©ºçš„cookie
          result.push(key +'=' + cookies[key]); // æ”¶é›†æœ‰æ•ˆcookie
        }  
    }
    var newCookie = result.join('; ');  //åˆ†å·åˆ†å‰² 
    document.cookie = newCookie;  // è®¾ç½®æ–°cookie
    return newCookie;
}
```

### å¤§å°æ•°ç›®æœ‰é™åˆ¶  
æµè§ˆå™¨å¯¹å¯¹ä¸€ä¸ªåŸŸçš„cookieå¤§å°å’Œæ•°ç›®éƒ½æœ‰ç€ä¸åŒçš„é™åˆ¶ã€‚   
| æµè§ˆå™¨ | æ•°ç›®(ä¸ª/åŸŸ) | æ€»å¤§å° | å…¶ä»– |
| ------ | ------ | ------ | ------ | 
| Firefox | 50ä¸ª  | 4k | | 
| Chrome | 53ä¸ª  | 4k || 
| Safari | æ— é™åˆ¶  | 4k |  | 
| IE 7+ | 50ä¸ª  | <4k |  ä½¿ç”¨LRUæ·˜æ±° |
| IE 6 | 20ä¸ª  | <4k |  ä½¿ç”¨LRUæ·˜æ±° |
| Opera | 30ä¸ª  | 4k || 

### cookieä¸è·¨åŸŸ 
å…³äºåŸŸçš„è®¾ç½®ï¼ŒğŸ‘†å‰é¢è®²è§£domainéƒ¨åˆ†æœ‰ä»‹ç»ã€‚     

`cookie`ä¸­çš„`domin`è®¾ç½®çš„è·¨åŸŸæ˜¯æŒ‡è·¨å­åŸŸåéƒ½ä¸å¯ä»¥è®¿é—®,ä¾‹å¦‚`www.baidu.com`å’Œ`map.baidu.com`æ˜¯ä¸å¯ä»¥è·¨åŸŸè¿›è¡Œè¯»å–å†…å®¹çš„ã€‚(çœ‹ä¸Šè¿°domainç¬¬ä¸€æ¡è§„åˆ™)     
![](/blog_assets/cookie_devtool.png) 
##### CORSä¸‹çš„cookieè·¨åŸŸ    
âœ… é¦–å…ˆæœåŠ¡ç«¯è¦è¿”å›`Access-Control-Allow-Credentials`è¡¨æ˜å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦`cookie`ï¼Œå¹¶ä¸”`Allow-Control-Allow-Origin`å­—æ®µä¹Ÿä¸èƒ½æ¨¡ç³Šçš„è¡¨ç¤ºä¸º`*`ï¼Œè€Œè¦å†™æ˜`cookie`å‘é€çš„åŸŸ   

âœ… å†è€…ï¼Œå®¢æˆ·ç«¯ä¹Ÿè¦è®¾ç½®è¯·æ±‚çš„æºå¸¦`cookie`     
```js
// åŸç”Ÿajaxè¯·æ±‚è®¾ç½®è·¨åŸŸæºå¸¦cookie
var xhr = new XMLHttpRequest(); 
xhr.withCredentials = true;
```
  

### cookieå…¶ä»–çŸ¥è¯†
1ï¸âƒ£  ç”±äº cookieä¼šåœ¨æ¯ä¸€æ¬¡è¯·æ±‚ä¸­éƒ½æºå¸¦æ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ï¼Œå½“cookieæ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œä¼šæµªè´¹å¸¦å®½ã€‚æ‰€ä»¥ï¼Œä¸å»ºè®®`cookie`å½“åšæˆ‘ä»¬çš„æœ¬åœ°æ•°æ®ä»“åº“ä½¿ç”¨ï¼Œè€Œä»…ä»…å»å­˜å‚¨ä¸€äº›ç”¨æˆ·çš„`id`,`sessionID`ä¹‹ç±»çš„èº«ä»½éªŒè¯æ€§çš„ç®€å•æ•°æ®ã€‚       

___
### cookieå’Œsessionä½“ç³» 


æˆ‘ä»¬çŸ¥é“`session`æ˜¯ä¸€ä¸ªä¸´æ—¶çš„è¿›ç¨‹ç»„ç¾¤ï¼Œç›®çš„æ˜¯å»å®Œæˆä¸€äº›ä»»åŠ¡ã€‚æ¯å½“OSæ¥æ”¶åˆ°æ–°ä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒåº¦è¿›ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œä¸€ä¸ªè¿›ç¨‹å¿™ä¸è¿‡æ¥å°±ä¼šç»§ç»­è°ƒç”¨å…¶ä»–è¿›ç¨‹æˆ–è€…åˆ›å»ºç´«ç¦åŸä¸€èµ·å»æ‰§è¡Œï¼Œå‡ºç°çš„è¿™äº›è¿›ç¨‹ä¼šè¢«åˆ†ä¸ºä¸€ä¸ªä¸ªçš„è¿›ç¨‹ç»„ï¼Œæœ€åè¿™äº›å…±åŒå®Œæˆä»»åŠ¡çš„è¿›ç¨‹ç»„ä¸€èµ·å¯ä»¥è¢«ç†è§£ä¸ºä¸€ä¸ª`session`ä¼šè¯ã€‚        

##### session+cookieå·¥ä½œè¿‡ç¨‹
1ï¸âƒ£ å½“å®¢æˆ·ç«¯é¦–æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ç»´æŠ¤ä¸€ä¸ªsessionï¼Œç”Ÿæˆä¸€ä¸ªsessionidï¼Œå€¼å¯ä»¥éšæ„çº¦å®šï¼Œå°±æ˜¯ä¸€ä¸ªç”¨äºæ ‡è®°sessionçš„å€¼ã€‚   

2ï¸âƒ£ serveré€šè¿‡httpè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°äº†å¹¶ä¿å­˜åœ¨cookieä¸­ã€‚     

3ï¸âƒ£ å®¢æˆ·ç«¯ç»“æŸæ‰äº†è¯·æ±‚è¿æ¥ï¼ŒæœåŠ¡ç«¯å°±ä¼šé‡Šæ”¾æ‰è¿™äº›è¿›ç¨‹å¯¹èµ„æºçš„å ç”¨ï¼Œæœ¬æ¬¡ä¼šè¯çš„`çŠ¶æ€`ä¼šè¢«æš‚æ—¶ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œåœ¨ä¸€å®šçš„æ—¶é—´å†…ï¼ŒæœåŠ¡ç«¯ä¼šä¿ç•™è¿™ä¸ªæ–‡ä»¶ã€‚       

4ï¸âƒ£ åœ¨è¶…æ—¶æ—¶é—´èŒƒå›´å†…ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è®¿é—®è¯¥åŸŸåéƒ½ä¼šç”¨`cookie`æºå¸¦`sessionid`åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å†æ ¹æ®`sessionid`æ‰¾å›ä¿å­˜ç€è®°å½•çŠ¶æ€çš„æ–‡ä»¶ï¼Œå†æ¬¡ä¸ºå®¢æˆ·æ‰“å¼€ä¸€ä¸ªæ–°çš„å¯¹è¯ï¼Œå¹¶ä¸”æ ¹æ®è¿™ä¸ªçŠ¶æ€ä¸­è®°å½•çš„å†…å®¹ï¼Œæ‰“å¼€å¯¹åº”çš„èµ„æºã€‚   

å¯¹äºå®¢æˆ·ç«¯æ¥çœ‹ï¼Œå®¢æˆ·ç«¯åæ¥æ¯æ¬¡å»è®¿é—®çš„æ—¶å€™éƒ½å¯ä»¥ç›´æ¥è·³è¿‡äº†èº«ä»½éªŒè¯ç­‰é‡å¤æ“ä½œï¼Œé€ æˆäº†å¥½åƒæœåŠ¡å™¨æ˜¯ä¸€ç›´åœ¨ç­‰å¾…å®¢æˆ·ç«¯çš„å‡è±¡ï¼Œå…¶å®æœåŠ¡å™¨åœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™å°±é‡Šæ”¾æ‰äº†å¯¹åº”çš„è¿›ç¨‹èµ„æºã€‚       

##### ä¼˜åŒ–æ”¹è¿›(token)
`é—®é¢˜ä¸€`     
sessionçŠ¶æ€æ–‡ä»¶ï¼Œåœ¨æœåŠ¡ç«¯æ˜¯ä¼šå ç”¨æœåŠ¡ç«¯çš„èµ„æºå’Œå†…å­˜ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦ç»´æŠ¤sessionçš„æ•°ç›®ï¼Œä»¥é˜²å†…å­˜çš„æº¢å‡ºã€‚ä½†æ˜¯ç”¨æˆ·æ•°ç›®ä¼—å¤šçš„æ—¶å€™ï¼ŒæœåŠ¡è¿˜æ˜¯ä¼šå› ä¸ºè¦ç»´æŠ¤`session`è€Œä¸å ªé‡è´Ÿã€‚     
`é—®é¢˜äºŒ`     
è‹¥ä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé‚£ä¹ˆè·¨æœåŠ¡å™¨éœ€è¦ç»´æŠ¤ä¸€ä¸ªåŒä¸€ä¸ªsessionï¼Œåˆ™éœ€è¦ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„sessionæœåŠ¡å™¨å»ç»´æŒè®¿é—®ã€‚ä¸€æ—¦sessionå´©æºƒï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ç”¨æˆ·çŠ¶æ€éƒ½ä¼šä¸¢å¤±ã€‚       

åŸºäºä»¥ä¸Šé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`æ—¶é—´æ¢ç©ºé—´`çš„æ€ç»´ï¼ŒæœåŠ¡ç«¯ä¸å†ä¿å­˜sessionä¿¡æ¯ï¼Œè€Œæ˜¯å°†è¿™éƒ¨åˆ†ä¿¡æ¯è¿›è¡Œç¼–ç åå†åŠ å¯†ï¼Œé€šè¿‡`cookie`è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º`token`ã€‚ä¸‹æ¬¡ç”¨æˆ·å†è¿›è¡Œç™»å½•çš„æ—¶å€™ï¼Œéƒ½æºå¸¦`token`è¿›è¡Œè®¿é—®ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ç§˜é’¥è¿›è¡Œè§£å¯†ï¼Œè‹¥èƒ½å¤Ÿè§£å¼€å¹¶ä¸”è§£ç¼–ç æˆåŠŸï¼Œåˆ™è¯´æ˜è¿™ä¸ª`token`æ˜¯ä¹‹å‰æœåŠ¡å™¨ä¸‹å‘çš„ï¼Œä¹Ÿå°±è¯æ˜äº†è¿™ä¸ªå®¢æˆ·ç«¯ç”¨æˆ·çš„åˆæ³•æ€§ã€‚

___
### å‚è€ƒæ–‡ç«    


[å¹²æ‰çŠ¶æ€ï¼šä» session åˆ° token](https://juejin.im/entry/592e286d44d9040064592a7b)   

[æ­£ç¡®ä½¿ç”¨cookieä¸­çš„domain](https://blog.csdn.net/u010856177/article/details/81104714)

