# 进击的http2
![](/blog_assets/http2_cover.png)
___
### 单一长链接
##### 1️⃣ 减少tcp握手次数，减少RTT
在请求的资源很多的情况下，`http1.x`是会同时打开`6~8`个`tcp`链接，而http2使用单一的`长链接`去加载所有资源。有效地减少了`tcp`握手所带来的时延,特别是当请求使用了`ssl`加密请求时，握手次数会大大增加。
##### 2️⃣ 减少慢启动时间
   每次的`TCP`链接，都会涉及到一个慢启动过程，也就是连接建立之后，数据线是慢慢地传，然后数据窗口再慢慢地增大，传输速度才达到稳定峰值。而`http2`减少`tcp`的连接数为`1`次，大大减少了冷启动的滑动窗口时间。
### 多路复用
##### 1️⃣ 数据被切分成`frame`传输
若把每次建立TCP连接，称之为修路的话，那么http2则只修了一条路，然后把不同文件请求的`data`切分为多个二进制`Frame`，头部信息放在`HEADER FRAME`,数据体存放在`data Frame`中，装在不同的的货车上，然后让他们同时在修好的道路上跑，充分利用了道路的宽度，也充分利用了现有的宽带带宽。
![多路复用](/blog_assets/HTTP2_data_frame.png)
##### 2️⃣ FIFO
每个数据帧都被打上标号，就像每一批货物都有自己的编号。同一种货物(最后要拼装在一起的不同部分)要遵循`FIFO`的原则去传输，但是不同种货物之间，可以相互穿插，先后出发。
##### 3️⃣ 不同类型文件，不同优先级下载 
针对不同类型的资源，HTTP2进行了不同程度的优先传输。比如页面传输中的，`script`和`link`会被优先传输，而类似于图片这种较大的文件优先级则降低。

### 压缩头部
##### 1️⃣ 明文header使用减少
在http1.x中，我们可以直接在报文中看到报文头的内容，便于开发人员调试。但随着https的普及，SSL加密传输也是plain text变成了二进制，明文调试也不存在。 
##### 2️⃣ 静态索引表，标记常见`header`内容
HTTP使用HPACK压缩来说压缩头部，减少了报文的大小。具体实现是将报文头中常见的一些字段变成一个索引值`index`，也就是维护一张静态索引表，例如把`method:POST`，`user-agent`，协议版本等，对影成一个`index`值。
静态索引表是固定的。
##### 3️⃣ 动态索引表，逐步建立
动态索引表功能类似于静态索引表，动态索引表的索引存放在静态索引表中。请求发现了新内容，则在动态索引表中建立新的索引。
##### 4️⃣ huffman压缩
对于经常变化的内容，类似于“资源路径”，`HPACK`压缩则使用`Huffman`编码进行压缩。
因为请求的文件过大，超过一个`TCP`报文时，会被分成几个`TCP`报文进行传输，压缩能够有效的减少TCP传输的数目。

### 服务端推送 Server push
##### 1️⃣ “缓存推送”
在客户端请求想服务端请求过一个资源"A"后，而服务端"预先"知道，客户端很有可能也会需要另一个资源"B"。
那么服务端就会在客户端请求“B”之前，主动将资源“B”推送给客户端
##### 2️⃣ 客户端许可推送
“缓存推送”需要客户端显式地允许服务端提供该功能。即使允许了“主动推送”，客户端仍能够传送"RST_STREAM"帧来终止这种主动推送服务。
___
## summary
##### 简述
1️⃣ 使用单一的长链接，减少SSL握手的开销
2️⃣ 头部被压缩，减少了数据传送量
3️⃣ 多路复用，将数据切分成`frame`，充分利用带宽
4️⃣ 不用像http1.0时代，强行将多个文件杂糅到成一个文件，分文件请求，使得`文件缓存`更有效命中。
##### 整体比较
![多路复用](/blog_assets/http2_youdian.jpg)
___
### 参考文章
 * [HTTP 2 的新特性你 get 了吗？](https://zhuanlan.zhihu.com/p/26433450)